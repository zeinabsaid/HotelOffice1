@page "/reception-dashboard"
@inherits ReceptionistDashboardBase

<PageTitle>لوحة تحكم الاستقبال</PageTitle>

@if (ViewModel.IsBusy && !ViewModel.RoomsWithStatus.Any())
{
    <div class="d-flex justify-content-center my-4">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
}

<div class="p-3">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2">حالة الغرف الحالية</h1>
        <button class="btn btn-sm btn-outline-secondary" @onclick="ViewModel.LoadRoomStatusesCommand.ExecuteAsync" disabled="@ViewModel.IsBusy">
            <span class="bi bi-arrow-clockwise"></span> تحديث
        </button>
    </div>

    <!-- عرض الغرف -->
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        @foreach (var roomStatus in ViewModel.RoomsWithStatus)
        {
            <div class="col">
                <div class="card h-100 shadow-sm border-start border-5" style="border-color: @roomStatus.StatusColor.ToHex() !important;">
                    <div class="card-body">
                        <h5 class="card-title fw-bold">غرفة رقم: @roomStatus.Room.RoomNumber</h5>
                        <p class="card-text">@roomStatus.StatusText</p>

                        <!-- ===> تم التعديل هنا لعرض نوع الغرفة بدلاً من الفئة <=== -->
                        <p class="card-text"><small class="text-muted">@roomStatus.Room.RoomType?.Name</small></p>

                        <div class="mt-3">
                            @if (roomStatus.IsAvailable)
                            {
                                <button class="btn btn-primary" @onclick='() => NavigateToBooking(roomStatus.Room.Id)'>حجز</button>
                            }
                            @if (roomStatus.CanCheckIn && roomStatus.ActiveBooking != null)
                            {
                                <button class="btn btn-info" @onclick='() => NavigateToBookingDetails(roomStatus.ActiveBooking.Id)'>تسجيل وصول</button>
                            }
                            @if (roomStatus.CanCheckOut && roomStatus.ActiveBooking != null)
                            {
                                <button class="btn btn-secondary" @onclick='() => NavigateToBookingDetails(roomStatus.ActiveBooking.Id)'>عرض التفاصيل</button>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    <hr class="my-5" />

    <!-- قسم تقارير الإيرادات -->
    <div class="card shadow-sm mt-4">
        <div class="card-header"><h2 class="h4 mb-0 text-center">تقارير الإيرادات</h2></div>
        <div class="card-body">
            <!-- ... (باقي كود قسم الإيرادات) ... -->
        </div>
    </div>
</div>